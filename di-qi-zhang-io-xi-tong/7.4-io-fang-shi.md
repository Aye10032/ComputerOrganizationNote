# 7.4 I/O方式

## 7.4.1 程序查询方式

```assembly
IN Rd,Rs #把IO端口Rs的数据输入到CPU寄存器Rd
OUT Rd,Rs #把CPU寄存器Rs的数据输出到IO端口Rd
```

### 1、一次工作的流程

1. CPU执行<mark style="color:orange;">**初始化**</mark>程序，并预置传送参数
   - 设置计数器
   - 设置数据首地址
2. 向I/O接口发送命令字，<mark style="color:orange;">**启动I/O设备**</mark>
3. CPU从接口读取设备状态信息
   - CPU不断查询I/O设备状态，直到外设准备就绪
4. 传送一次数据，一般为一个字
5. 修改参数
   - 修改地址
   - 修改计数器
6. 判断传送是否结束，未结束则继续传输

### 2、程序查询方式的优缺点

- 优点
  - 接口设计简单
  - 设备量少
- 缺点
  - CPU在信息传送过程中要花费很多时间用于查询和等待
  - CPU在一段时间内只能和一台外设交换信息
  - 效率低

## 7.4.2 程序中断方式

### 1、中断的基本概念

CPU在每一个指令的末尾会检测是否存在中断

检测到中断时，会进行断点保存，并在中断处理结束后从断点恢复程序

I/O设备的中断属于<mark style="color:purple;">**外中断**</mark>，且是<mark style="color:purple;">**可屏蔽中断**</mark>

### 2、中断的工作流程

#### （1）中断请求

中断源向CPU发出中断请求

CPU根据<mark style="color:purple;">**中断标志位**</mark>判断中断来自谁

#### （2）中断判优



1. 
   - CPU根据<mark style="color:purple;">**中断标志位**</mark>判断中断来自谁
2. CPU判断中断条件
   - 是否在进行关中断（通过PSW），关中断期间不响应中断信号
     - IF=1，表明允许中断
     - IF=0表示不允许进行中断
   - 中断判优：判断多个中断的优先级
     - 通过硬件：排队器等
     - 通过软件：使用查询程序等
3. CPU进行中断响应
   - 通过中断隐指令找到正确的中断指令
   - 执行中断程序

