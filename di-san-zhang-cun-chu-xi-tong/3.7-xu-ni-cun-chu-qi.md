# 3.7 虚拟存储器

## 3.7.1 虚拟存储器的基本概念

**页式存储系统**：一个程序（进程）在逻辑上被分为若千个大小相等的“页面”, “页面”大小与“块”的大小相同。每个页面可以<mark style="color:orange;">**离散地**</mark>放入不同的主存块中。

**逻辑地址**：变量、指令等在程序中的相对地址

**物理地址**：实际在主存中存放的地址

**页表**：每一个页表项中记录着逻辑页号和与之对应的主存块号，<mark style="color:orange;">**页表位于主存中**</mark>



## 3.7.2 逻辑地址访问过程

1. 将逻辑地址拆分为<mark style="color:blue;">**页号**</mark>**+**<mark style="color:purple;">**页内地址**</mark>
2. 根据页号查找页表，找到该页存放的<mark style="color:yellow;">**主存块号**</mark>
3. 将主存块号与页内地址拼接，得到要访问数据的物理地址
4. 访问相应的主存块，依照相应的Cache工作原理访问Cache和主存
5. 将逻辑地址拆分为<mark style="color:blue;">**页号**</mark>**+**<mark style="color:purple;">**页内地址**</mark>
6. 根据页号查找页表，找到该页存放的<mark style="color:yellow;">**主存块号**</mark>
7. 将主存块号与页内地址拼接，得到要访问数据的物理地址
8. 访问相应的主存块，依据相应的工作原理查找Cache和主存，访问内容



## 3.7.3 快表（TLB）

快表是一种相联存储器，读取速度快。快表中存放的是页表的副本，Cache中存放的是主存块的副本。

引入了快表之后的查询过程：

1. 将逻辑地址拆分为<mark style="color:blue;">**页号**</mark>**+**<mark style="color:purple;">**页内地址**</mark>
2. 根据页号查询TLB
   1. TLB命中
      1. 直接得到该页面的<mark style="color:yellow;">**主存块号**</mark>
   2. TLB未命中
      1. 根据页号查找页表，找到该页存放的<mark style="color:yellow;">**主存块号**</mark>
      2. 将该页表项复制到TLB 
3. 将主存块号与页内地址拼接，得到要访问数据的物理地址
4. 在Cache中查找相应的主存块
   1. Cache命中
      1. 直接从Cache中得到目标数据
   2. Cache未命中
      1. 从主存中访问目标数据
      2. 将主存块复制到Cache中

与Cache类似，快表存满时，也用类似的算法进行替换。



## 3.7.4 虚拟存储器

基于局部性原理，仅将将一部分内容从外存调入内存中。
